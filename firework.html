<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Ph√°o hoa üéÜ</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
}
canvas {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 1;
}

.wish-container {
  position: fixed;
  pointer-events: none;
  z-index: 10;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transform: scale(0.5);
  transition: opacity 0.5s ease, transform 0.5s ease;
}

.wish-container.show {
  opacity: 1;
  transform: scale(1);
}

.wish-image {
  max-width: 200px;
  max-height: 200px;
  border-radius: 10px;
  box-shadow: 0 0 30px rgba(255, 255, 255, 0.5),
              0 0 60px rgba(255, 215, 0, 0.3);
  margin-bottom: 15px;
  animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
  from {
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.5),
                0 0 40px rgba(255, 215, 0, 0.3);
  }
  to {
    box-shadow: 0 0 40px rgba(255, 255, 255, 0.8),
                0 0 80px rgba(255, 215, 0, 0.6);
  }
}

.wish-text {
  color: #fff;
  font-size: 24px;
  font-weight: bold;
  text-align: center;
  text-shadow: 
    0 0 10px rgba(255, 255, 255, 0.8),
    0 0 20px rgba(255, 215, 0, 0.6),
    0 0 30px rgba(255, 215, 0, 0.4);
  padding: 10px 20px;
  background: rgba(0, 0, 0, 0.5);
  border-radius: 10px;
  border: 2px solid rgba(255, 215, 0, 0.5);
}
</style>
</head>
<body>

<canvas id="fireworks"></canvas>

<script>
/* ===================== CANVAS ===================== */
const canvas = document.getElementById("fireworks");
const ctx = canvas.getContext("2d");
let cw, ch;

function resize() {
  cw = canvas.width = window.innerWidth;
  ch = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

function random(min, max) {
  return Math.random() * (max - min) + min;
}
function distance(x1, y1, x2, y2) {
  return Math.hypot(x2 - x1, y2 - y1);
}

/* ===================== WISHES & IMAGES ===================== */
// M·∫£ng c√¢u ch√∫c - b·∫°n c√≥ th·ªÉ th√™m/s·ª≠a c√°c c√¢u ch√∫c ·ªü ƒë√¢y
const wishes = [
  "Ch√∫c m·ª´ng nƒÉm m·ªõi!",
  "An khang th·ªãnh v∆∞·ª£ng!",
  "V·∫°n s·ª± nh∆∞ √Ω!",
  "T·∫•n t√†i t·∫•n l·ªôc!",
  "S·ª©c kh·ªèe d·ªìi d√†o!",
  "M√£i b√™n nhau b·∫°n nh√©!",
  "Th√†nh c√¥ng r·ª±c r·ª°!",
  "May m·∫Øn c·∫£ nƒÉm!",
  "Y√™u em r·∫•t nhi·ªÅu!",
  "Gia ƒë√¨nh h·∫°nh ph√∫c!"
];

// M·∫£ng ƒë∆∞·ªùng d·∫´n ·∫£nh - b·∫°n c√≥ th·ªÉ th√™m ƒë∆∞·ªùng d·∫´n ·∫£nh v√†o ƒë√¢y
// V√≠ d·ª•: ["images/img1.jpg", "images/img2.png", ...]
const imagePaths = [
  // Th√™m ƒë∆∞·ªùng d·∫´n ·∫£nh c·ªßa b·∫°n v√†o ƒë√¢y
  "images/Anh (1).jpg",
  "images/Anh (2).jpg",
  "images/Anh (3).jpg",
  "images/Anh (4).jpg",
  "images/Anh (5).jpg",
  "images/Anh (6).jpg",
  "images/Anh (7).jpg",
  "images/Anh (8).jpg",
  "images/Anh (9).jpg",

];

// H√†m l·∫•y ·∫£nh ng·∫´u nhi√™n
function getRandomImage() {
  if (imagePaths.length === 0) return null;
  return imagePaths[Math.floor(Math.random() * imagePaths.length)];
}

// H√†m l·∫•y c√¢u ch√∫c ng·∫´u nhi√™n
function getRandomWish() {
  return wishes[Math.floor(Math.random() * wishes.length)];
}

// Hi·ªÉn th·ªã ·∫£nh v√† c√¢u ch√∫c khi ph√°o hoa n·ªï
function showWishAndImage(x, y) {
  const wish = getRandomWish();
  const imagePath = getRandomImage();
  
  // T·∫°o container
  const container = document.createElement('div');
  container.className = 'wish-container';
  container.style.left = x + 'px';
  container.style.top = y + 'px';
  container.style.transform = 'translate(-50%, -50%)';
  
  // Th√™m ·∫£nh n·∫øu c√≥
  if (imagePath) {
    const img = document.createElement('img');
    img.src = imagePath;
    img.className = 'wish-image';
    img.alt = 'Wish Image';
    img.onerror = () => {
      // N·∫øu ·∫£nh l·ªói, ·∫©n ·∫£nh ƒëi
      img.style.display = 'none';
    };
    container.appendChild(img);
  }
  
  // Th√™m c√¢u ch√∫c
  const text = document.createElement('div');
  text.className = 'wish-text';
  text.textContent = wish;
  container.appendChild(text);
  
  document.body.appendChild(container);
  
  // Hi·ªÉn th·ªã v·ªõi animation
  setTimeout(() => {
    container.classList.add('show');
  }, 10);
  
  // ·∫®n v√† x√≥a sau 1.5 gi√¢y
  setTimeout(() => {
    container.classList.remove('show');
    setTimeout(() => {
      container.remove();
    }, 500);
  }, 1500);
}

/* ===================== AUDIO ===================== */
const fireworkSoundUrl =
  "https://pic.pikbest.com/17/97/21/79v888piCusf.mp3";

// gi·ªõi h·∫°n √¢m thanh ƒë·ªìng th·ªùi
let activeSounds = 0;
const MAX_ACTIVE_SOUNDS = 4;
let audioEnabled = false;

// T·ª± ƒë·ªông k√≠ch ho·∫°t audio ngay khi trang load
function enableAudio() {
  if (audioEnabled) return;
  audioEnabled = true;
  
  // T·∫°o v√† play m·ªôt audio ng·∫Øn ƒë·ªÉ unlock audio context
  const unlockAudio = new Audio(fireworkSoundUrl);
  unlockAudio.volume = 0.01;
  unlockAudio.play().then(() => {
    unlockAudio.pause();
    unlockAudio.currentTime = 0;
  }).catch(() => {});
}

// Enable audio ngay khi DOM ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', enableAudio);
} else {
  enableAudio();
}

// Th·ª≠ enable ngay khi load
window.addEventListener('load', () => {
  enableAudio();
});

// T·ª± ƒë·ªông enable audio khi c√≥ b·∫•t k·ª≥ t∆∞∆°ng t√°c n√†o (backup)
const enableAudioEvents = ['click', 'touchstart', 'mousedown', 'keydown', 'mousemove'];
enableAudioEvents.forEach(event => {
  document.addEventListener(event, enableAudio, { once: true });
});

function createAudio(volume) {
  const audio = new Audio(fireworkSoundUrl);
  audio.volume = volume;
  audio.preload = "auto";
  // Th·ª≠ load ngay
  audio.load();
  return audio;
}

function playLimited(audio) {
  if (!audio || activeSounds >= MAX_ACTIVE_SOUNDS) return;
  
  // T·ª± ƒë·ªông enable n·∫øu ch∆∞a enable
  if (!audioEnabled) {
    enableAudio();
  }
  
  activeSounds++;
  audio.currentTime = 0;
  audio.play().catch(()=>{});
  audio.onended = () => activeSounds--;
}

/* ===================== FIREWORK ===================== */
class Firework {
  constructor(sx, sy, tx, ty) {
    this.x = sx;
    this.y = sy;
    this.sx = sx;
    this.sy = sy;
    this.tx = tx;
    this.ty = ty;

    this.distanceToTarget = distance(sx, sy, tx, ty);
    this.distanceTraveled = 0;

    this.angle = Math.atan2(ty - sy, tx - sx);
    this.speed = 18;
    this.acceleration = 1.06;
    this.brightness = random(50, 70);

    this.coordinates = [];
    for (let i = 0; i < 3; i++) {
      this.coordinates.push([this.x, this.y]);
    }

    // üîä ch·ªâ ~35% ph√°o c√≥ ti·∫øng
    this.hasSound = Math.random() < 0.35;

    this.launchSound = this.hasSound ? createAudio(0.2) : null;
    this.explosionSound = this.hasSound ? createAudio(0.35) : null;

    this.launchPlayed = false;
    this.exploded = false;
  }

  update(index) {
    // √¢m b·∫Øn (1 l·∫ßn)
    if (this.hasSound && !this.launchPlayed) {
      const heightFactor = 1 - this.y / ch;
      this.launchSound.volume = 0.1 + heightFactor * 0.15;
      playLimited(this.launchSound);
      this.launchPlayed = true;
    }

    this.coordinates.pop();
    this.coordinates.unshift([this.x, this.y]);

    this.speed *= this.acceleration;

    const vx = Math.cos(this.angle) * this.speed;
    const vy = Math.sin(this.angle) * this.speed;

    this.distanceTraveled = distance(
      this.sx,
      this.sy,
      this.x + vx,
      this.y + vy
    );

    if (this.distanceTraveled >= this.distanceToTarget) {
      if (!this.exploded) {
        createParticles(this.tx, this.ty);

        // Hi·ªÉn th·ªã ·∫£nh v√† c√¢u ch√∫c khi n·ªï (10% c∆° h·ªôi - √≠t h∆°n cho ƒë·∫πp)
        if (Math.random() < 0.1) {
          showWishAndImage(this.tx, this.ty);
        }

        if (this.hasSound) {
          const heightFactor = 1 - this.y / ch;
          this.explosionSound.volume = 0.2 + heightFactor * 0.25;
          // delay nh·∫π ƒë·ªÉ nghe t·ª± nhi√™n
          setTimeout(() => playLimited(this.explosionSound), random(30, 80));
        }

        this.exploded = true;
      }
      fireworks.splice(index, 1);
    } else {
      this.x += vx;
      this.y += vy;
    }
  }

  draw() {
    ctx.beginPath();
    ctx.moveTo(
      this.coordinates[this.coordinates.length - 1][0],
      this.coordinates[this.coordinates.length - 1][1]
    );
    ctx.lineTo(this.x, this.y);
    ctx.strokeStyle = `hsl(${random(0,360)},100%,${this.brightness}%)`;
    ctx.stroke();
  }
}

/* ===================== PARTICLE ===================== */
class Particle {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.angle = random(0, Math.PI * 2);
    this.speed = random(2, 7);
    this.friction = 0.95;
    this.gravity = 0.25;
    this.hue = random(0, 360);
    this.brightness = random(50, 80);
    this.alpha = 1;
    this.decay = random(0.005, 0.01);

    this.coordinates = [];
    for (let i = 0; i < 6; i++) {
      this.coordinates.push([this.x, this.y]);
    }
  }

  update(index) {
    this.coordinates.pop();
    this.coordinates.unshift([this.x, this.y]);

    this.speed *= this.friction;
    this.x += Math.cos(this.angle) * this.speed;
    this.y += Math.sin(this.angle) * this.speed + this.gravity;

    this.alpha -= this.decay;
    if (this.alpha <= 0) {
      particles.splice(index, 1);
    }
  }

  draw() {
    ctx.beginPath();
    ctx.moveTo(
      this.coordinates[this.coordinates.length - 1][0],
      this.coordinates[this.coordinates.length - 1][1]
    );
    ctx.lineTo(this.x, this.y);
    ctx.strokeStyle =
      `hsla(${this.hue},100%,${this.brightness}%,${this.alpha})`;
    ctx.stroke();
  }
}

/* ===================== CREATE PARTICLES ===================== */
function createParticles(x, y) {
  let count = 30;
  while (count--) particles.push(new Particle(x, y));
}

/* ===================== LOOP ===================== */
let fireworks = [];
let particles = [];
let lastFireworkTime = 0;

function loop() {
  requestAnimationFrame(loop);

  ctx.globalCompositeOperation = "destination-out";
  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.fillRect(0, 0, cw, ch);
  ctx.globalCompositeOperation = "lighter";

  for (let i = fireworks.length - 1; i >= 0; i--) {
    fireworks[i].draw();
    fireworks[i].update(i);
  }

  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].draw();
    particles[i].update(i);
  }

  const now = Date.now();
  if (fireworks.length < 25 && now - lastFireworkTime > 120) {
    const x = random(80, cw - 80);
    const ty = random(60, ch / 2);
    fireworks.push(new Firework(x, ch, x, ty));
    lastFireworkTime = now;
  }
}
loop();
</script>

</body>
</html>
