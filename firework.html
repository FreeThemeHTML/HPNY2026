<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ph√°o Hoa üéÜüß®</title>
  <style>
    html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: black;
}

canvas {
  display: block;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 0;
}
  </style>
</head>
<body>
  <canvas id="fireworks"></canvas>
  <script>
    const canvas = document.getElementById("fireworks");
const ctx = canvas.getContext("2d");
let cw, ch;

function resize() {
  cw = canvas.width = window.innerWidth;
  ch = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

function random(min, max) {
  return Math.random() * (max - min) + min;
}

function distance(aX, aY, bX, bY) {
  const dx = bX - aX;
  const dy = bY - aY;
  return Math.sqrt(dx * dx + dy * dy);
}

class Firework {
  constructor(sx, sy, tx, ty) {
    this.x = sx;
    this.y = sy;
    this.sx = sx;
    this.sy = sy;
    this.tx = tx;
    this.ty = ty;
    this.distanceToTarget = distance(sx, sy, tx, ty);
    this.distanceTraveled = 0;
    this.coordinates = [];
    this.coordinateCount = 3;
    while(this.coordinateCount--) {
      this.coordinates.push([this.x, this.y]);
    }
    this.angle = Math.atan2(ty - sy, tx - sx);
    this.speed = 10;
    this.acceleration = 1.08;
    this.brightness = random(50, 70);
    this.targetRadius = 8;
  }

  update(index) {
    this.coordinates.pop();
    this.coordinates.unshift([this.x, this.y]);

    if(this.targetRadius < 8) this.targetRadius += 0.3;
    this.speed *= this.acceleration;

    const vx = Math.cos(this.angle) * this.speed;
    const vy = Math.sin(this.angle) * this.speed;
    this.distanceTraveled = distance(this.sx, this.sy, this.x + vx, this.y + vy);

    if(this.distanceTraveled >= this.distanceToTarget) {
      // 35% c∆° h·ªôi t·∫°o tr√°i tim, 65% t·∫°o ph√°o hoa b√¨nh th∆∞·ªùng
      const isHeart = Math.random() < 0.35;
      createParticles(this.tx, this.ty, isHeart);
      fireworks.splice(index, 1);
    } else {
      this.x += vx;
      this.y += vy;
    }
  }

  draw() {
    ctx.beginPath();
    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
    ctx.lineTo(this.x, this.y);
    ctx.strokeStyle = `hsl(${random(0, 360)}, 100%, ${this.brightness}%)`;
    ctx.stroke();

    // ctx.beginPath();
    // ctx.arc(this.tx, this.ty, this.targetRadius, 0, Math.PI * 2);
    // ctx.stroke();
  }
}

class Particle {
  constructor(x, y, isHeart = false, heartAngle = 0, heartDistance = 0) {
    this.x = x;
    this.y = y;
    this.coordinates = [];
    this.coordinateCount = 8;
    while(this.coordinateCount--) {
      this.coordinates.push([this.x, this.y]);
    }
    if (isHeart) {
      // T·∫°o h·∫°t theo h√¨nh tr√°i tim - bay ra t·ª´ v·ªã tr√≠ tr√™n ƒë∆∞·ªùng tr√°i tim
      this.angle = heartAngle;
      this.speed = random(4, 7);
      this.initialDistance = heartDistance;
      // M√†u h·ªìng/t√≠m cho tr√°i tim - s√°ng h∆°n
      this.hue = random(300, 340); // Pink/Purple range
      this.brightness = random(80, 100);
    } else {
      this.angle = random(0, Math.PI * 2);
      this.speed = random(2, 8);
      this.initialDistance = 0;
      this.hue = random(0, 360);
      this.brightness = random(50, 80);
    }
    this.friction = 0.97;
    this.gravity = 0.2;
    this.alpha = 1;
    this.decay = random(0.004, 0.008); // Ch·∫≠m h∆°n nhi·ªÅu
    this.isHeart = isHeart;
  }

  update(index) {
    this.coordinates.pop();
    this.coordinates.unshift([this.x, this.y]);
    this.speed *= this.friction;
    
    if (this.isHeart) {
      // H·∫°t tr√°i tim bay ra ngo√†i t·ª´ t√¢m theo h∆∞·ªõng ƒë√£ ƒë·ªãnh
      this.x += Math.cos(this.angle) * this.speed;
      this.y += Math.sin(this.angle) * this.speed + this.gravity * 0.3;
    } else {
      this.x += Math.cos(this.angle) * this.speed;
      this.y += Math.sin(this.angle) * this.speed + this.gravity;
    }
    
    this.alpha -= this.decay;

    if(this.alpha <= 0) {
      particles.splice(index, 1);
    }
  }

  draw() {
    ctx.beginPath();
    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
    ctx.lineTo(this.x, this.y);
    
    if (this.isHeart) {
      // Tr√°i tim c√≥ ƒë·ªô d√†y v√† s√°ng h∆°n
      ctx.lineWidth = 2.5;
      ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
      // Th√™m glow effect
      ctx.shadowBlur = 10;
      ctx.shadowColor = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha * 0.5})`;
    } else {
      ctx.lineWidth = 1;
      ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
      ctx.shadowBlur = 0;
    }
    ctx.stroke();
    ctx.lineWidth = 1; // Reset v·ªÅ m·∫∑c ƒë·ªãnh
    ctx.shadowBlur = 0; // Reset shadow
  }
}

// H√†m t·∫°o ph∆∞∆°ng tr√¨nh tr√°i tim
function heartShape(t, scale = 1) {
  // Ph∆∞∆°ng tr√¨nh tham s·ªë c·ªßa tr√°i tim
  const x = scale * 16 * Math.pow(Math.sin(t), 3);
  const y = scale * -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
  return { x, y };
}

function createParticles(x, y, isHeart = false) {
  if (isHeart) {
    // T·∫°o h·∫°t theo h√¨nh tr√°i tim - ƒë·∫∑t tr·ª±c ti·∫øp tr√™n ƒë∆∞·ªùng tr√°i tim
    const scale = 4; // K√≠ch th∆∞·ªõc tr√°i tim
    const particleCount = 150; // S·ªë ƒëi·ªÉm tr√™n ƒë∆∞·ªùng tr√°i tim
    
    // T·∫°o c√°c h·∫°t d·ªçc theo ƒë∆∞·ªùng tr√°i tim
    for (let i = 0; i < particleCount; i++) {
      const t = (i / particleCount) * Math.PI * 2;
      const heart = heartShape(t, scale);
      
      // T√≠nh g√≥c ph√°p tuy·∫øn (normal) c·ªßa ƒë∆∞·ªùng tr√°i tim ƒë·ªÉ h·∫°t bay ra ngo√†i
      const dt = 0.05;
      const heartNext = heartShape(t + dt, scale);
      const dx = heartNext.x - heart.x;
      const dy = heartNext.y - heart.y;
      // G√≥c ph√°p tuy·∫øn (vu√¥ng g√≥c v·ªõi ti·∫øp tuy·∫øn)
      const tangentAngle = Math.atan2(dy, dx);
      const normalAngle = tangentAngle + Math.PI / 2;
      
      // T·∫°o nhi·ªÅu h·∫°t tr√™n m·ªói ƒëi·ªÉm ƒë·ªÉ t·∫°o ƒë·ªô d√†y
      const layers = 4;
      for (let layer = 0; layer < layers; layer++) {
        // ƒê·∫∑t h·∫°t ·ªü v·ªã tr√≠ tr√™n ƒë∆∞·ªùng tr√°i tim, h∆°i l√πi v√†o trong m·ªôt ch√∫t
        const offsetFactor = 0.7 + (layer / layers) * 0.3; // T·ª´ 0.7 ƒë·∫øn 1.0
        const particleX = x + heart.x * offsetFactor;
        const particleY = y + heart.y * offsetFactor;
        
        // G√≥c bay ra ngo√†i (theo h∆∞·ªõng ph√°p tuy·∫øn)
        let angle = normalAngle;
        // Th√™m m·ªôt ch√∫t ng·∫´u nhi√™n nh·ªè ƒë·ªÉ t·ª± nhi√™n h∆°n
        angle += random(-0.15, 0.15);
        
        const particle = new Particle(particleX, particleY, true, angle, 0);
        particles.push(particle);
      }
    }
    
    // Th√™m m·ªôt s·ªë h·∫°t ·ªü t√¢m ƒë·ªÉ t·∫°o ƒë·ªô s√°ng
    for (let i = 0; i < 30; i++) {
      const randomAngle = random(0, Math.PI * 2);
      const particle = new Particle(x, y, true, randomAngle, 0);
      particles.push(particle);
    }
  } else {
    // T·∫°o h·∫°t b√¨nh th∆∞·ªùng
    let particleCount = 30;
    while(particleCount--) {
      particles.push(new Particle(x, y));
    }
  }
}

let fireworks = [];
let particles = [];

function loop() {
  requestAnimationFrame(loop);
  ctx.globalCompositeOperation = 'destination-out';
  ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
  ctx.fillRect(0, 0, cw, ch);
  ctx.globalCompositeOperation = 'lighter';

  for (let i = fireworks.length - 1; i >= 0; i--) {
    fireworks[i].draw();
    fireworks[i].update(i);
  }

  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].draw();
    particles[i].update(i);
  }

  // B·∫Øn ph√°o hoa li√™n t·ª•c h∆°n, kh√¥ng c·∫ßn ƒë·ª£i qu√° nhi·ªÅu
  if(fireworks.length < 8) {
    // B·∫Øn t·ª´ nhi·ªÅu ƒëi·ªÉm ng·∫´u nhi√™n ·ªü d∆∞·ªõi c√πng m√†n h√¨nh, b·∫Øn th·∫≥ng l√™n
    const startX = random(50, cw - 50); // V·ªã tr√≠ ng·∫´u nhi√™n ·ªü d∆∞·ªõi c√πng
    const startY = ch; // Lu√¥n t·ª´ d∆∞·ªõi c√πng
    const targetX = startX; // C√πng v·ªã tr√≠ X ƒë·ªÉ b·∫Øn th·∫≥ng l√™n
    const targetY = random(50, ch / 2); // M·ª•c ti√™u ·ªü n·ª≠a tr√™n m√†n h√¨nh
    
    fireworks.push(new Firework(
      startX,
      startY,
      targetX,
      targetY
    ));
  }
}
loop();
  </script>
</body>
</html>